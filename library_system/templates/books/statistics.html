<!-- templates/books/statistics.html -->
{% extends 'base.html' %}

{% block title %}Statistika - Kutubxona{% endblock %}

{% block extra_css %}
<style>
    .stat-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        text-align: center;
    }
    .stat-box h2 {
        font-size: 3rem;
        font-weight: bold;
        margin-bottom: 10px;
    }
    .stat-box p {
        font-size: 1.2rem;
        margin: 0;
    }
    .progress-custom {
        height: 30px;
        border-radius: 15px;
        font-size: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1><i class="bi bi-graph-up"></i> Kutubxona statistikasi</h1>
        <p class="text-muted">Umumiy ko'rsatkichlar va tahlillar</p>
    </div>
</div>

<!-- Main Statistics -->
<div class="row mb-5">
    <div class="col-md-3 col-sm-6">
        <div class="stat-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <i class="bi bi-book-fill" style="font-size: 3rem;"></i>
            <h2>{{ stats.total_books }}</h2>
            <p>Jami kitoblar</p>
        </div>
    </div>

    <div class="col-md-3 col-sm-6">
        <div class="stat-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            <i class="bi bi-check-circle-fill" style="font-size: 3rem;"></i>
            <h2>{{ stats.available_books }}</h2>
            <p>Mavjud kitoblar</p>
        </div>
    </div>

    <div class="col-md-3 col-sm-6">
        <div class="stat-box" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
            <i class="bi bi-person-lines-fill" style="font-size: 3rem;"></i>
            <h2>{{ stats.borrowed_books }}</h2>
            <p>Olingan kitoblar</p>
        </div>
    </div>

    <div class="col-md-3 col-sm-6">
        <div class="stat-box" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
            <i class="bi bi-exclamation-triangle-fill" style="font-size: 3rem;"></i>
            <h2>{{ stats.overdue_books }}</h2>
            <p>Muddati o'tgan</p>
        </div>
    </div>
</div>

<!-- Additional Stats -->
<div class="row mb-5">
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-person-fill"></i> Mualliflar</h5>
            </div>
            <div class="card-body text-center">
                <h1 class="display-4 text-primary">{{ stats.total_authors }}</h1>
                <p class="text-muted">Jami mualliflar soni</p>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-grid-3x3-gap"></i> Kategoriyalar</h5>
            </div>
            <div class="card-body text-center">
                <h1 class="display-4 text-success">{{ stats.total_categories }}</h1>
                <p class="text-muted">Jami kategoriyalar soni</p>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="bi bi-plus-circle"></i> Yangi qo'shilgan</h5>
            </div>
            <div class="card-body text-center">
                <h1 class="display-4 text-info">{{ recent_additions }}</h1>
                <p class="text-muted">Oxirgi 30 kunda</p>
            </div>
        </div>
    </div>
</div>

<!-- Availability Progress -->
<div class="row mb-5">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="bi bi-pie-chart"></i> Kitoblar mavjudligi</h5>
            </div>
            <div class="card-body">
                {% widthratio stats.available_books stats.total_books 100 as available_percent %}
                {% widthratio stats.borrowed_books stats.total_books 100 as borrowed_percent %}

                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-2">
                        <span><i class="bi bi-check-circle text-success"></i> Mavjud kitoblar</span>
                        <strong>{{ available_percent }}%</strong>
                    </div>
                    <div class="progress progress-custom">
                        <div class="progress-bar bg-success" role="progressbar"
                             style="width: {{ available_percent }}%">
                            {{ stats.available_books }} kitob
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-2">
                        <span><i class="bi bi-book text-primary"></i> Olingan kitoblar</span>
                        <strong>{{ borrowed_percent }}%</strong>
                    </div>
                    <div class="progress progress-custom">
                        <div class="progress-bar bg-primary" role="progressbar"
                             style="width: {{ borrowed_percent }}%">
                            {{ stats.borrowed_books }} kitob
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Category Statistics -->
<div class="row mb-5">
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="bi bi-bar-chart"></i> Kategoriyalar bo'yicha kitoblar</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Kategoriya</th>
                                <th>Kitoblar soni</th>
                                <th>Foiz</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for category in category_stats %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    <a href="{% url 'category_detail' category.id %}" class="text-decoration-none">
                                        {{ category.name }}
                                    </a>
                                </td>
                                <td><span class="badge bg-primary">{{ category.book_count }}</span></td>
                                <td>
                                    {% widthratio category.book_count stats.total_books 100 as percent %}
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar bg-info" role="progressbar"
                                             style="width: {{ percent }}%">
                                            {{ percent }}%
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Language Statistics -->
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="bi bi-translate"></i> Tillar bo'yicha kitoblar</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Til</th>
                                <th>Kitoblar soni</th>
                                <th>Foiz</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for lang in language_stats %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ lang.language }}</td>
                                <td><span class="badge bg-warning text-dark">{{ lang.count }}</span></td>
                                <td>
                                    {% widthratio lang.count stats.total_books 100 as percent %}
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar bg-warning" role="progressbar"
                                             style="width: {{ percent }}%">
                                            {{ percent }}%
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0"><i class="bi bi-lightning-fill"></i> Tezkor harakatlar</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3">
                        <a href="{% url 'book_list' %}" class="btn btn-outline-primary btn-lg w-100">
                            <i class="bi bi-book"></i><br>
                            Kitoblar
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{% url 'category_list' %}" class="btn btn-outline-success btn-lg w-100">
                            <i class="bi bi-grid-3x3-gap"></i><br>
                            Kategoriyalar
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{% url 'borrow_history' %}" class="btn btn-outline-info btn-lg w-100">
                            <i class="bi bi-clock-history"></i><br>
                            Tarix
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="/admin/" class="btn btn-outline-danger btn-lg w-100">
                            <i class="bi bi-gear"></i><br>
                            Admin
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
